import{W as isBrowser,aE as commonLight,aI as changeColor,x as cB,d as defineComponent,C as useConfig,E as computed,F as useTheme,H as createKey,I as useThemeClass,q as h,z as c,aW as pxfy,as as mergeProps,bx as repeat,aM as Fragment,b7 as useRoute,bq as useTabStore,r as ref,a as onMounted,o as openBlock,n as createBlock,w as withCtx,f as createBaseVNode,e as createVNode,i as createTextVNode,h as unref,c as createElementBlock,t as toDisplayString,b4 as renderList,b9 as createCommentVNode,bi as isRef,bZ as cloneDeep,k as _sfc_main$1,l as __unplugin_components_5,p as __unplugin_components_8,b2 as pushScopeId,b3 as popScopeId,_ as _export_sfc}from"./index-0cd3d109.js";import{c as conversionPrice,_ as __unplugin_components_1}from"./conversion-f539d77f.js";import{e as getProductDetail,f as getSkuProperties}from"./index-61177ec1.js";import{f as formatLength}from"./Tooltip-2a71edd4.js";import{_ as __unplugin_components_0}from"./Tag-0085b362.js";import{_ as __unplugin_components_6}from"./InputNumber-e058a88e.js";import{_ as __unplugin_components_7}from"./Divider-599dccf7.js";import"./Input-8aa57a92.js";import"./use-compitable-e16c1e92.js";let houdiniRegistered=!1;function useHoudini(){if(isBrowser&&window.CSS&&!houdiniRegistered&&(houdiniRegistered=!0,"registerProperty"in(window==null?void 0:window.CSS)))try{CSS.registerProperty({name:"--n-color-start",syntax:"<color>",inherits:!1,initialValue:"#0000"}),CSS.registerProperty({name:"--n-color-end",syntax:"<color>",inherits:!1,initialValue:"#0000"})}catch{}}const self$1=e=>{const{primaryColor:t,successColor:o,warningColor:n,errorColor:s,infoColor:r,fontWeightStrong:u}=e;return{fontWeight:u,rotate:"252deg",colorStartPrimary:changeColor(t,{alpha:.6}),colorEndPrimary:t,colorStartInfo:changeColor(r,{alpha:.6}),colorEndInfo:r,colorStartWarning:changeColor(n,{alpha:.6}),colorEndWarning:n,colorStartError:changeColor(s,{alpha:.6}),colorEndError:s,colorStartSuccess:changeColor(o,{alpha:.6}),colorEndSuccess:o}},gradientTextLight={name:"GradientText",common:commonLight,self:self$1},gradientTextLight$1=gradientTextLight,style$1=cB("gradient-text",`
 display: inline-block;
 font-weight: var(--n-font-weight);
 -webkit-background-clip: text;
 background-clip: text;
 color: #0000;
 white-space: nowrap;
 background-image: linear-gradient(var(--n-rotate), var(--n-color-start) 0%, var(--n-color-end) 100%);
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier);
`),gradientTextProps=Object.assign(Object.assign({},useTheme.props),{size:[String,Number],fontSize:[String,Number],type:{type:String,default:"primary"},color:[Object,String],gradient:[Object,String]}),__unplugin_components_4=defineComponent({name:"GradientText",props:gradientTextProps,setup(e){useHoudini();const{mergedClsPrefixRef:t,inlineThemeDisabled:o}=useConfig(e),n=computed(()=>{const{type:a}=e;return a==="danger"?"error":a}),s=computed(()=>{let a=e.size||e.fontSize;return a&&(a=formatLength(a)),a||void 0}),r=computed(()=>{const a=e.color||e.gradient;if(typeof a=="string")return a;if(a){const m=a.deg||0,i=a.from,l=a.to;return`linear-gradient(${m}deg, ${i} 0%, ${l} 100%)`}}),u=useTheme("GradientText","-gradient-text",style$1,gradientTextLight$1,e,t),p=computed(()=>{const{value:a}=n,{common:{cubicBezierEaseInOut:m},self:{rotate:i,[createKey("colorStart",a)]:l,[createKey("colorEnd",a)]:f,fontWeight:g}}=u.value;return{"--n-bezier":m,"--n-rotate":i,"--n-color-start":l,"--n-color-end":f,"--n-font-weight":g}}),d=o?useThemeClass("gradient-text",computed(()=>n.value[0]),p,e):void 0;return{mergedClsPrefix:t,compatibleType:n,styleFontSize:s,styleBgImage:r,cssVars:o?void 0:p,themeClass:d==null?void 0:d.themeClass,onRender:d==null?void 0:d.onRender}},render(){const{mergedClsPrefix:e,onRender:t}=this;return t==null||t(),h("span",{class:[`${e}-gradient-text`,`${e}-gradient-text--${this.compatibleType}-type`,this.themeClass],style:[{fontSize:this.styleFontSize,backgroundImage:this.styleBgImage},this.cssVars]},this.$slots)}}),self=e=>{const{heightSmall:t,heightMedium:o,heightLarge:n,borderRadius:s}=e;return{color:"#eee",colorEnd:"#ddd",borderRadius:s,heightSmall:t,heightMedium:o,heightLarge:n}},skeletonLight={name:"Skeleton",common:commonLight,self},style=c([cB("skeleton",`
 height: 1em;
 width: 100%;
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 animation: 2s skeleton-loading infinite cubic-bezier(0.36, 0, 0.64, 1);
 background-color: var(--n-color-start);
 `),c("@keyframes skeleton-loading",`
 0% {
 background: var(--n-color-start);
 }
 40% {
 background: var(--n-color-end);
 }
 80% {
 background: var(--n-color-start);
 }
 100% {
 background: var(--n-color-start);
 }
 `)]),skeletonProps=Object.assign(Object.assign({},useTheme.props),{text:Boolean,round:Boolean,circle:Boolean,height:[String,Number],width:[String,Number],size:String,repeat:{type:Number,default:1},animated:{type:Boolean,default:!0},sharp:{type:Boolean,default:!0}}),__unplugin_components_3=defineComponent({name:"Skeleton",inheritAttrs:!1,props:skeletonProps,setup(e){useHoudini();const{mergedClsPrefixRef:t}=useConfig(e),o=useTheme("Skeleton","-skeleton",style,skeletonLight,e,t);return{mergedClsPrefix:t,style:computed(()=>{var n,s;const r=o.value,{common:{cubicBezierEaseInOut:u}}=r,p=r.self,{color:d,colorEnd:a,borderRadius:m}=p;let i;const{circle:l,sharp:f,round:g,width:_,height:v,size:S,text:B,animated:y}=e;S!==void 0&&(i=p[createKey("height",S)]);const k=l?(n=_??v)!==null&&n!==void 0?n:i:_,x=(s=l?_??v:v)!==null&&s!==void 0?s:i;return{display:B?"inline-block":"",verticalAlign:B?"-0.125em":"",borderRadius:l?"50%":g?"4096px":f?"":m,width:typeof k=="number"?pxfy(k):k,height:typeof x=="number"?pxfy(x):x,animation:y?"":"none","--n-bezier":u,"--n-color-start":d,"--n-color-end":a}})}},render(){const{repeat:e,style:t,mergedClsPrefix:o,$attrs:n}=this,s=h("div",mergeProps({class:`${o}-skeleton`,style:t},n));return e>1?h(Fragment,null,repeat(e,null).map(r=>[s,`
`])):s}});function isPrime(e){for(let t=2;t<e;++t)if(e%t===0)return!1;return!0}function getPrime(e){let t=2;const o=[];for(t;o.length<e;t++)isPrime(t)&&o.push(t);return o}const _withScopeId=e=>(pushScopeId("data-v-4eb07683"),e=e(),popScopeId(),e),_hoisted_1={class:"info"},_hoisted_2={class:"preview"},_hoisted_3={class:"img-wrapper border-1px border-#efeff5 dark:border-#ffffff17"},_hoisted_4={class:"flex-center mt-10px"},_hoisted_5={class:"flex-center mr-30px"},_hoisted_6=_withScopeId(()=>createBaseVNode("p",{class:"text-12px mt-4px"},"选择免费送货服务",-1)),_hoisted_7={class:"flex-center"},_hoisted_8=_withScopeId(()=>createBaseVNode("p",{class:"text-12px mt-4px"},"简单免费的退货服务",-1)),_hoisted_9={class:"detail"},_hoisted_10={class:"name"},_hoisted_11={key:0},_hoisted_12={key:1},_hoisted_13={class:"item price-wrapper bg-#f5f5f5 dark:bg-#2f2f31"},_hoisted_14=_withScopeId(()=>createBaseVNode("div",{class:"label"},"价格",-1)),_hoisted_15={class:"flex value"},_hoisted_16=_withScopeId(()=>createBaseVNode("span",null,"￥",-1)),_hoisted_17=_withScopeId(()=>createBaseVNode("span",null,"￥",-1)),_hoisted_18=_withScopeId(()=>createBaseVNode("span",null,"~",-1)),_hoisted_19={class:"label"},_hoisted_20={class:"flex value mt--10px"},_hoisted_21={key:0,class:"item"},_hoisted_22=_withScopeId(()=>createBaseVNode("div",{class:"label"},"库存",-1)),_hoisted_23={class:"value"},_hoisted_24={class:"item"},_hoisted_25=_withScopeId(()=>createBaseVNode("div",{class:"label"},"数量",-1)),_hoisted_26={class:"value"},_hoisted_27={class:"item operation pl-85px"},_hoisted_28=_withScopeId(()=>createBaseVNode("div",{class:"desc-list text-12px lh-tight color-#6e6e73 px-20px"},[createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("ol",null,[createBaseVNode("li",null,"一些有关紧要的描述"),createBaseVNode("li",null,"一些有关紧要的描述"),createBaseVNode("li",null,"一些有关紧要的描述"),createBaseVNode("li",null,"一些有关紧要的描述"),createBaseVNode("li",null,"一些有关紧要的描述"),createBaseVNode("li",null,"一些有关紧要的描述")]),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述"),createBaseVNode("p",null,"一些也许无关紧要的描述")],-1)),_sfc_main=defineComponent({__name:"detail",setup(__props){const route=useRoute(),tabStore=useTabStore(),loading=ref(!1),skus=ref([]),skuInPrime=ref({}),primeMatrix=ref([]),skuPrimeList=ref([]),stateMatrix=ref([]),skuProperties=ref([]),primeCoordinate=ref({}),selected=ref([]),disabled=ref([]),purchaseNum=ref(1),prodDetail=ref({name:"",skuList:[]}),generateSpecPrimeDict=e=>{const t=e.map(s=>s.typeList.map(r=>r.id)).filter(s=>s),o=getPrime(t.flat().length),n={};t.flat().forEach((s,r)=>{n[s]=o[r]}),skuInPrime.value=n,primeMatrix.value=t.map(s=>s.map(r=>n[r]))},generateSKU=list=>{const skuKeys=["typeId","faceValueId","billId"],skuList=list.map(item=>{const prime=Object.entries(item).map(([e,t])=>skuKeys.includes(e)?skuInPrime.value[Number(t)]:null).filter(e=>e);return{...item,skuPrime:prime,skuPrimeTotal:eval(prime.join("*"))}});skus.value=skuList,skuPrimeList.value=skuList.map(e=>e.stockNum>0?e.skuPrimeTotal:null).filter(e=>e)},generatePathFinder=()=>{primeMatrix.value.forEach((e,t)=>{const o=[];e.forEach((n,s)=>{primeCoordinate.value[`${n}`]=[t,s],o.push(1)}),stateMatrix.value.push(o)})},selectSpec=e=>{selected.value.indexOf(e)>-1?removeSpec(e):addSpec(e),updateDisabled()},addSpec=e=>{const t=primeCoordinate.value[e];handlingSpecRowState(t),selected.value.push(e),stateMatrix.value[t[0]][t[1]]=2,updateStateMatrix()},removeSpec=e=>{selected.value.forEach((t,o)=>{if(t===e){const n=primeCoordinate.value[t];stateMatrix.value[n[0]][n[1]]=1,selected.value.splice(o,1)}}),updateStateMatrix()},updateStateMatrix=()=>{stateMatrix.value.forEach((e,t)=>{const o=getRowMultipication(t);e.forEach((n,s)=>{n!==2&&(stateMatrix.value[t][s]=getSelectState(primeMatrix.value[t][s],o)?1:0)})})},getRowMultipication=e=>{let t=1;return selected.value.length&&selected.value.forEach(o=>{primeCoordinate.value[o][0]!==e&&(t*=o)}),t},getSelectState=(e,t)=>{const o=e*t;return skuPrimeList.value.some(n=>{if(n%o===0)return!0})},updateDisabled=()=>{const e=cloneDeep(stateMatrix.value);stateMatrix.value.forEach((t,o)=>{t.forEach((n,s)=>{n&&(e[o][s]=primeMatrix.value[o][s])})}),disabled.value=e.flat()},handlingSpecRowState=e=>{selected.value.forEach((t,o)=>{const n=primeCoordinate.value[t];n[0]===e[0]&&(stateMatrix.value[n[0]][n[1]]=1,selected.value.splice(o,1))})},loadDetail=()=>new Promise((e,t)=>{getProductDetail({id:+route.params.id}).then(o=>{prodDetail.value=o.data,tabStore.modifyTabMeta(route.fullPath,{...route.meta,title:o.data.name}),e()})}),loadProperties=()=>new Promise((e,t)=>{getSkuProperties().then(o=>{skuProperties.value=o.data,e()})}),initProductConfig=()=>{loading.value=!0,Promise.all([loadDetail(),loadProperties()]).then(()=>{generateSpecPrimeDict(skuProperties.value),generateSKU(prodDetail.value.skuList),generatePathFinder(),updateStateMatrix(),updateDisabled(),loading.value=!1})},selectedSKU=computed(()=>{if(selected.value.length===skuProperties.value.length){const selectedMultipication=eval(selected.value.join("*")),index=skus.value.findIndex(e=>e.skuPrimeTotal?e.skuPrimeTotal===+selectedMultipication:!1);if(index>-1){const e=skus.value[index];return purchaseNum.value>e.stockNum&&(purchaseNum.value=e.stockNum),e}else return null}return null}),productPrice=computed(()=>{const e=prodDetail.value.skuList.map(t=>t.sellPrice);return{selectedPrice:selectedSKU.value?selectedSKU.value.sellPrice:null,minPrice:Math.min(...e),maxPrice:Math.max(...e)}}),purchaseButton=ref(null),handlerMouseMove=e=>{const t=purchaseButton.value.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;e.target.style.setProperty("--x",`${o}px`),e.target.style.setProperty("--y",`${n}px`)};return onMounted(()=>{initProductConfig()}),(e,t)=>{const o=__unplugin_components_0,n=__unplugin_components_1,s=_sfc_main$1,r=__unplugin_components_3,u=__unplugin_components_4,p=__unplugin_components_5,d=__unplugin_components_6,a=__unplugin_components_7,m=__unplugin_components_8;return openBlock(),createBlock(m,{size:"small",class:"wrapper"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(o,{class:"tag",bordered:!1,type:"warning"},{default:withCtx(()=>[createTextVNode(" 促销速买 ")]),_:1}),createVNode(n,{src:"https://elife-dev.oss-cn-shanghai.aliyuncs.com/20231030/%E4%BA%AC%E4%B8%9C&33612&20231030133516..jpg"})]),createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createVNode(s,{class:"text-24px",icon:"fluent-mdl2:product"}),_hoisted_6]),createBaseVNode("div",_hoisted_7,[createVNode(s,{class:"text-24px",icon:"tabler:truck-return"}),_hoisted_8])])]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[unref(loading)?(openBlock(),createBlock(r,{key:0,width:"33%"})):(openBlock(),createElementBlock(Fragment,{key:1},[unref(selectedSKU)?(openBlock(),createElementBlock("span",_hoisted_11,toDisplayString(unref(selectedSKU).name),1)):(openBlock(),createElementBlock("span",_hoisted_12,toDisplayString(unref(prodDetail).name),1))],64))]),unref(loading)?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(r,{class:"item"}),createVNode(r,{class:"item"}),createVNode(r,{class:"item"}),createVNode(r,{class:"item"}),createVNode(r,{class:"item"})],64)):(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_13,[_hoisted_14,createBaseVNode("div",_hoisted_15,[unref(productPrice).selectedPrice?(openBlock(),createBlock(u,{key:0,size:24,type:"danger"},{default:withCtx(()=>[_hoisted_16,createTextVNode(" "+toDisplayString(unref(conversionPrice)(unref(productPrice).selectedPrice)),1)]),_:1})):(openBlock(),createBlock(u,{key:1,size:24,type:"danger"},{default:withCtx(()=>[_hoisted_17,createBaseVNode("span",null,toDisplayString(unref(conversionPrice)(unref(productPrice).minPrice)),1),_hoisted_18,createBaseVNode("span",null,toDisplayString(unref(conversionPrice)(unref(productPrice).maxPrice)),1)]),_:1}))])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(skuProperties),i=>(openBlock(),createElementBlock("div",{key:i.id,class:"item"},[createBaseVNode("div",_hoisted_19,toDisplayString(i.name),1),createBaseVNode("div",_hoisted_20,[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.typeList,l=>(openBlock(),createBlock(p,{key:l.id,class:"mr-10px mt-10px min-w-130px",type:unref(selected).includes(unref(skuInPrime)[l.id])?"primary":"default",disabled:!unref(disabled).includes(unref(skuInPrime)[l.id]),onClick:f=>selectSpec(unref(skuInPrime)[l.id])},{default:withCtx(()=>[createTextVNode(toDisplayString(l.name),1)]),_:2},1032,["type","disabled","onClick"]))),128))])]))),128)),unref(selectedSKU)?(openBlock(),createElementBlock("div",_hoisted_21,[_hoisted_22,createBaseVNode("div",_hoisted_23,toDisplayString(unref(selectedSKU).stockNum),1)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_24,[_hoisted_25,createBaseVNode("div",_hoisted_26,[createVNode(d,{value:unref(purchaseNum),"onUpdate:value":t[0]||(t[0]=i=>isRef(purchaseNum)?purchaseNum.value=i:null),max:unref(selectedSKU)?unref(selectedSKU).stockNum:1e4,min:1,clearable:""},null,8,["value","max"])])])],64)),createBaseVNode("div",_hoisted_27,[createBaseVNode("button",{ref_key:"purchaseButton",ref:purchaseButton,class:"ky-button ky-button-shadow bg-primary",onMousemove:handlerMouseMove}," 立即购买 ",544)])])]),createVNode(a),_hoisted_28]),_:1})}}}),detail_vue_vue_type_style_index_0_scoped_4eb07683_lang="",detail=_export_sfc(_sfc_main,[["__scopeId","data-v-4eb07683"]]);export{detail as default};
